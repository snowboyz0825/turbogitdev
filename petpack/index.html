<!DOCTYPE HTML>
<html lang="en-US">

<head>
    <title>Name II Pet Pack</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylehseet" href="styles/modals.css">
    <style>
        body {
            background-color: #070e12;
        }

        .heading {
            font-size: 30pt;
        }

        .subheading {
            font-size: 24pt;
        }

        * {
            font-family: Arial, Helvetica, sans-serif;
            color: white
        }

        .imgdesc {
            text-align: center;
        }

        .item {
            width: 256px;
            cursor: pointer;
        }

        .item_image {
            width: 256px;
            height: 256px;
        }

        .maingrid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .heading,
        .subheading {
            text-align: center;
            font-weight: normal;
        }
    </style>
</head>

<body>
    <div class="modal_back modal_hide"></div>
    <div class="modal_hide modal">
        <h3 class="modal-x">&times;</h3>
        <h4 class="modal-title"></h4>
        <div class="modal-content"><img class="modal-image">
            <p class="modal-desc">Creator: sally_5808<br>
                Category: Allays Doing Things<br>
                Name Tag: Allay Popsicle</p>
        </div>
    </div>
</body>
<script>
    function initialize() {
        const modalX = document.querySelector(".modal-x")
        const modalBack = document.querySelector(".modal_back")
        modalX.addEventListener("click", () => {
            closeModal()
        })
        modalBack.addEventListener("click", () => {
            closeModal()
        })
        document.addEventListener("keydown", (keypressed) => {
            if (keypressed.key === "Escape") {
                closeModal()
            }
        })
    }
    initialize()
    populate();
    async function populate() {
        var x = -1
        const temp = await fetch("allays.json");
        const references = await temp.json();

        references.forEach(item => {
            x++
            console.log(x)
            let longCategories = (references[x]).categories_long;
            let shortCategories = (references[x]).categories_short;
            let longsCategories = (references[x]).subcategories_long;
            let shortsCategories = (references[x]).subcategories_short
            let id = references[x].id
            let title = references[x].title

            let scx = -1
            shortCategories.forEach(item => {
                scx++
                // if the category does not exist, we create onesa
                if (!document.querySelector("." + shortCategories[scx] + ".heading")) {

                    let newH2 = document.createElement('h1')
                    newH2.classList.add(shortCategories[scx], "heading")
                    newH2.innerHTML = longCategories[scx]
                    console.log(newH2.outerHTML)
                    document.body.appendChild(newH2)
                }
                if (shortsCategories[0]) {
                    // if there is a subcatregory
                    //we check if it exists
                    if (!document.querySelector("." + shortsCategories[scx] + ".subheading")) {
                        //if it doesn't we make one
                        let newH4 = document.createElement('h4')
                        newH4.classList.add(shortsCategories[scx], "subheading")
                        newH4.innerHTML = longsCategories[scx]
                        console.log(newH4.outerHTML)
                        document.body.appendChild(newH4)
                    }
                    //grid creation
                    var maingrid = document.querySelector("." + shortsCategories[scx] + ".maingrid")
                    //if there isn't a maingrid of the correct class
                    if (!maingrid) {
                        var maingrid = document.createElement('div')
                        maingrid.classList.add("maingrid", shortsCategories[scx])
                    }
                    //item creation
                    var newDiv = document.createElement('div')
                    newDiv.classList.add("item")
                    newDiv.innerHTML = `<img class="item_image" loading="lazy" src="previews/${shortCategories[scx]}/${shortsCategories[scx]}/${id}.png"><p class="imgdesc">${title}</p>`
                    event_temp(newDiv, title, id, `previews/${shortCategories[scx]}/${shortsCategories[scx]}/${id}.png`)

                } else {
                    // if there isn't a subcategory
                    var maingrid = document.querySelector("." + shortCategories[scx] + ".maingrid")
                    //if there isn't a maingrid of the correct class
                    if (!maingrid) {
                        var maingrid = document.createElement('div')
                        maingrid.classList.add("maingrid", shortCategories[scx])
                    }
                    //item creation
                    var newDiv = document.createElement('div')
                    newDiv.dataset.id = id;
                    newDiv.classList.add("item")
                    newDiv.innerHTML = `<img class="item_image" loading="lazy" src="previews/${shortCategories[scx]}/${id}.png"><p class="imgdesc">${title}</p>`
                    event_temp(newDiv, title, id, `previews/${shortCategories[scx]}/${id}.png`)
                    //console.log(document.body.innerHTML)
                    //console.log(document.head.innerHTML)
                }
                maingrid.appendChild(newDiv);
                document.body.appendChild(maingrid)
            })
        })
        //    console.log(longCategories)
        //    console.log(shortCategories)
    };

    function closeModal() {
        const modal = document.querySelector(".modal")
        modal.classList.remove("modal_shown")
        modal.classList.add("modal_hide")
        const modalBack = document.querySelector(".modal_back")
        modalBack.classList.remove("modal_shown")
        modalBack.classList.add("modal_hide")
    }
    //modal logic
    function event_temp(newDiv, title, id, imgSrc) {
        newDiv.addEventListener("click", () => {
            setModalLayout()
            console.log("Clicked item:", title, id);
            const modal = document.querySelector(".modal")
            modal.classList.remove("modal_hide")
            modal.classList.add("modal_shown")
            const modalBack = document.querySelector(".modal_back")
            modalBack.classList.remove("modal_hide")
            modalBack.classList.add("modal_shown")
            const modalTitle = document.querySelector(".modal-title")
            const modalImage = document.querySelector(".modal-image")
            modalTitle.textContent = title
            modalImage.src = imgSrc

        });
    }

    //changes modal based on width/height
    function setModalLayout() {
        const modalContent = document.querySelector(".modal-content")
        const modaldesc = document.querySelector(".modal-desc")
        const isPortrait = window.innerHeight > window.innerWidth
        modalContent.classList.toggle("portrait", isPortrait);
        modaldesc.classList.toggle("portrait", isPortrait);
    } 
</script>

</html>