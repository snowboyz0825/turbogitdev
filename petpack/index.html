<!DOCTYPE HTML>
<html lang="en-US">

<head>
    <title>Name II Pet Pack</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            background-color: #070e12;
        }

        .heading {
            font-size: 30pt;
        }

        .subheading {
            font-size: 24pt;
        }

        * {
            font-family: Arial, Helvetica, sans-serif;
            color: white
        }

        .imgdesc {
            text-align: center;
        }

        .item {
            width: 256px;
            cursor: pointer;
        }

        .item_image {
            width: 256px;
            height: 256px;
        }

        .maingrid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .heading,
        .subheading {
            text-align: center;
            font-weight: normal;
        }

        .modal-title {
            font-size: 24px;
            font-weight: normal;
            margin-top: 6px;
        }

        .modal-desc {
            line-height: 1.6;
            align-self: flex-start;
            margin: 6px;
        }

        .modal-desc.portrait {
            line-height: 1.6;
            text-align: center;
            padding: 6px;
        }

        .modal-image {
            padding: 12px;
        }

        .modal-x {
            margin-top: 12px;
            padding-right: 12px;
            align-self: flex-end;
            font-size: 18pt;
            cursor: pointer;
        }

        .modal-content {
            display: flex;
            align-items: flex-start;
            margin-top: 0;
        }

        .modal-content.portrait {
            flex-direction: column;
            align-items: center;
            margin-top: 0;

        }

        .modal_back {
            position: fixed;
            width: 100000px;
            top: 0;
            left: 0;
            height: 100000px;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .modal {
            z-index: 1000;
            position: fixed;
            inset: 0;
            justify-content: center;
            margin: auto;
            background-color: #05090c;
            border: 3.5px solid #020506;
            align-items: center;
            flex-direction: column;
            width: fit-content;
            height: fit-content;
            padding: 0 12px 12px 12px;
            border-radius: 12px;
        }

        /*change the display to flex once the modal is shown*/
        .modal_hide {
            display: none;
        }

        .modal_shown {
            display: flex;
        }
    </style>
</head>

<body>
    <div class="modal_back modal_hide"></div>
    <div class="modal_hide modal">
        <h3 class="modal-x">&times;</h3>
        <h4 class="modal-title"></h4>
        <div class="modal-content"><img class="modal-image">
            <p class="modal-desc"></p>
        </div>
    </div>
</body>
<script>
    function initialize() {
        const modalX = document.querySelector(".modal-x")
        const modalBack = document.querySelector(".modal_back")
        modalX.addEventListener("click", () => {
            closeModal()
            console.log("clicked x")
        })
        modalBack.addEventListener("click", () => {
            closeModal()
        })
        document.addEventListener("keydown", (keypressed) => {
            if (keypressed.key === "Escape") {
                closeModal()
            }
        })
    }
    initialize()
    populate();
    async function populate() {
        var x = -1
        const temp = await fetch("allays.json");
        const references = await temp.json();

        references.forEach(item => {
            x++
            console.log(x)
            let longCategories = (references[x]).categories_long;
            let shortCategories = (references[x]).categories_short;
            let longsCategories = (references[x]).subcategories_long;
            let shortsCategories = (references[x]).subcategories_short
            let id = references[x].id
            let title = references[x].title
            let desc = references[x].desc
            let entity = references[x].entity

            let scx = -1
            shortCategories.forEach(item => {
                scx++
                // if the category does not exist, we create one
                if (!document.querySelector("." + shortCategories[scx] + ".heading")) {

                    let newH2 = document.createElement('h1')
                    newH2.classList.add(shortCategories[scx], "heading")
                    newH2.innerHTML = longCategories[scx]
                    console.log(newH2.outerHTML)
                    document.body.appendChild(newH2)
                }
                if (shortsCategories[0]) {
                    // if there is a subcatregory
                    //we check if it exists
                    if (!document.querySelector("." + shortsCategories[scx] + ".subheading")) {
                        //if it doesn't we make one
                        let newH4 = document.createElement('h4')
                        newH4.classList.add(shortsCategories[scx], "subheading")
                        newH4.innerHTML = longsCategories[scx]
                        console.log(newH4.outerHTML)
                        document.body.appendChild(newH4)
                    }
                    //grid creation
                    var maingrid = document.querySelector("." + shortsCategories[scx] + ".maingrid")
                    //if there isn't a maingrid of the correct class
                    if (!maingrid) {
                        var maingrid = document.createElement('div')
                        maingrid.classList.add("maingrid", shortsCategories[scx])
                    }
                    //item creation
                    var newDiv = document.createElement('div')
                    newDiv.classList.add("item")
                    const imgSrc = `previews/${entity}/${shortCategories[scx]}/${shortsCategories[scx]}/${id}.webp`
                    newDiv.innerHTML = `<img class="item_image" loading="lazy" src="${imgSrc}"><p class="imgdesc">${title}</p>`
                    event_temp(newDiv, title, id, imgSrc, desc)

                } else {
                    // if there isn't a subcategory
                    var maingrid = document.querySelector("." + shortCategories[scx] + ".maingrid")
                    //if there isn't a maingrid of the correct class
                    if (!maingrid) {
                        var maingrid = document.createElement('div')
                        maingrid.classList.add("maingrid", shortCategories[scx])
                    }
                    //item creation
                    var newDiv = document.createElement('div')
                    newDiv.dataset.id = id;
                    newDiv.classList.add("item")
                    const imgSrc = `previews/${entity}/${shortCategories[scx]}/${id}.webp`
                    newDiv.innerHTML = `<img class="item_image" loading="lazy" src="${imgSrc}"><p class="imgdesc">${title}</p>`
                    event_temp(newDiv, title, id, imgSrc, desc)
                    //console.log(document.body.innerHTML)
                    //console.log(document.head.innerHTML)
                }
                maingrid.appendChild(newDiv);
                document.body.appendChild(maingrid)
            })
        })
        //    console.log(longCategories)
        //    console.log(shortCategories)
    };

    function closeModal() {
        const modal = document.querySelector(".modal")
        modal.classList.remove("modal_shown")
        modal.classList.add("modal_hide")
        const modalBack = document.querySelector(".modal_back")
        modalBack.classList.remove("modal_shown")
        modalBack.classList.add("modal_hide")
    }
    //modal logic
    function event_temp(newDiv, title, id, imgSrc, desc) {
        newDiv.addEventListener("click", () => {
            console.log("Clicked item:", title, id);
            const params = new URLSearchParams({
                item: 5,
            });
            params.set("item", "99");
            const modal = document.querySelector(".modal")
            const deleteMeDesc = modal.querySelector(".modal-desc");
            if (deleteMeDesc) deleteMeDesc.remove();
            modal.innerHTML += desc;
            modal.classList.remove("modal_hide")
            modal.classList.add("modal_shown")
            const modalBack = document.querySelector(".modal_back")
            modalBack.classList.remove("modal_hide")
            modalBack.classList.add("modal_shown")
            const modalTitle = document.querySelector(".modal-title")
            const modalImage = document.querySelector(".modal-image")
            modalTitle.textContent = title
            modalImage.src = imgSrc
            setModalLayout()
        });
    }

    //changes modal based on width/height
    function setModalLayout() {
        const modalContent = document.querySelector(".modal-content")
        const modaldesc = document.querySelector(".modal-desc")
        const isPortrait = window.innerHeight > window.innerWidth
        modalContent.classList.toggle("portrait", isPortrait);
        modaldesc.classList.toggle("portrait", isPortrait);
    } 
</script>

</html>